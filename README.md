# Image Compressor (converter-web)

PWA для сжатия и конвертации изображений в браузере. Работает офлайн после первой загрузки.

- **Версия:** 1.0.0  
- **Платформа:** Flutter Web

## Возможности

После загрузки фото доступны инструменты:

| Инструмент | Описание |
|------------|----------|
| **Сжать** | Перекодирование в JPEG с настраиваемым качеством (1–100%). |
| **Конвертировать** | Смена формата: JPEG, PNG, BMP, GIF. |
| **Размер** | Изменение ширины/высоты или масштаба в процентах. |
| **Повернуть** | Поворот на 90°, 180° или 270°. |
| **Отразить** | Отражение по горизонтали и/или вертикали. |
| **Обрезать** | Обрезка по центру (процент от ширины и высоты). |
| **Фильтры** | Яркость, контраст, насыщенность, ч/б, сепия, размытие. |
| **Редактор** | Обрезка, размер, поворот, отражение и фильтры в одном экране. |
| **Увеличить** | Масштаб 100–200% от текущего размера. |
| **Улучшить качество** | Резкость (частично компенсирует размытие). |
| **Размытие** | Гауссово размытие всего изображения (радиус 0–10). |
| **Убрать размытие** | То же, что «Улучшить качество». |
| **Водяной знак** | Текст поверх фото: позиция (углы) и прозрачность. |
| **Убрать вод. знак** | Информационный экран (автоудаление не поддерживается). |
| **Размытие лиц** | Автоматическое обнаружение лиц (Face Detector API в браузере) и размытие областей. Лучше всего работает в Chrome. |
| **Удалить фон** | Удаление фона по цвету углов; результат — PNG с прозрачностью. |
| **Рисовать** | Рисование поверх фото: цвет, толщина линии, отмена/очистка. Сохранение в PNG. |

## Запуск локально

В терминале перейди в корень проекта и запусти сервер:

```bash
python3 -m http.server 8080
```

Приложение откроется по адресу **http://localhost:8080/** (без подпути).

## Сборка из исходников

Основные модули: `lib/main.dart`, `lib/home_page.dart`, `lib/action_pages.dart`, `lib/image_service.dart`, `lib/file_loader.dart`, `lib/download_helper.dart`, `lib/face_detector.dart`. Шаблон веб-оболочки: `web/index.html`.

```bash
flutter pub get
flutter build web
```

Результат сборки — в `build/web/`. Чтобы обновить сайт в корне проекта, скопируй содержимое `build/web/` в корень.

Разработка с горячей перезагрузкой:

```bash
flutter pub get
flutter run -d chrome
```

## Тесты

Для сборки и тестов нужен **Flutter** в PATH. Если команда `flutter` не находится:

1. Установи Flutter: https://docs.flutter.dev/get-started/install/macos  
2. Если Flutter уже лежит в Документах (`~/Documents/flutter`), добавь в `~/.zshrc`:  
   `export PATH="$PATH:$HOME/Documents/flutter/bin"`  
   Затем выполни `source ~/.zshrc`.  
   Или для другого пути: `export PATH="$PATH:/путь/к/flutter/bin"`.

Запуск тестов:

```bash
flutter pub get
flutter test
```

Тесты (в `test/`):

| Файл | Что проверяется |
|------|------------------|
| `app_test.dart` | Запуск приложения, заголовок, подзаголовок, отсутствие debug banner |
| `app_theme_test.dart` | Цвета, отступы, склонение «файл» (fileCount) |
| `image_service_test.dart` | Декодирование, сжатие, конвертация, resize, rotate, flip, blur, blurRegions, crop, removeBackground, sharpen |
| `file_loader_test.dart` | loadFileBytes: пустые аргументы, picked с/без bytes |
| `download_helper_test.dart` | Stub: UnsupportedError вне веба |
| `face_detector_test.dart` | detectFaces: тип возврата, stub возвращает пустой список |
| `home_page_test.dart` | Заголовок, зона загрузки, кнопки инструментов, навигация на все экраны (в т.ч. Убрать вод. знак), «Загрузить другие», отсутствие наложения контента |
| `action_pages_test.dart` | CompressPage, ConvertPage, SharpenPage, FaceBlurPage, RemoveBackgroundPage, DrawOnPhotoPage, RemoveWatermarkPage при пустых аргументах или статическом контенте, отсутствие наложения |

## Структура проекта

| Путь | Назначение |
|------|------------|
| `index.html` | Точка входа (развёрнутый сайт), экран загрузки |
| `main.dart.js` | Скомпилированное приложение |
| `flutter.js`, `flutter_bootstrap.js` | Загрузчик Flutter |
| `canvaskit/` | Движок рендеринга (локальный) |
| `manifest.json` | PWA: название, иконки, тема |
| `flutter_service_worker.js` | Офлайн и кэш |
| `lib/main.dart` | Точка входа приложения, тема |
| `lib/home_page.dart` | Главная страница, зона загрузки, кнопки инструментов |
| `lib/action_pages.dart` | Экраны действий (Сжать, Конвертировать, Размер, Рисовать и др.) |
| `lib/image_service.dart` | Обработка изображений (сжатие, конвертация, фильтры и т.д.) |
| `lib/file_loader.dart` | Загрузка байтов из выбранных/сброшенных файлов |
| `lib/download_helper.dart` | Скачивание (веб / заглушка) |
| `lib/face_detector.dart` | Детекция лиц (веб / заглушка) |
| `web/index.html` | Шаблон для `flutter build web`, скрипт Face Detector |

Артефакты сборки (`build/`, `.dart_tool/`, `.last_build_id` и др.) перечислены в `.gitignore`.

## UX и доступность

- **Единая тема** — цвета, отступы и скругления заданы в `lib/app_theme.dart` и используются везде.
- **Загрузка файлов** — два способа: перетаскивание в зону и кнопка «Выбрать файлы» (альтернатива для тех, кто не использует drag-and-drop).
- **Обратная связь** — после загрузки в зоне показывается состояние успеха (галочка и «Загружено: N») на 2 секунды; при неверном типе файла — SnackBar с пояснением.
- **Доступность** — семантика для заголовка страницы, зоны загрузки и карточек действий (screen reader).
- **Минимальный размер нажатия** — интерактивные области не меньше 48px (`AppTheme.minTouchTarget`).

## Деплой

Размести содержимое корня (или `build/web/` после сборки) на любом хостинге статики. Для подпути укажи нужный `<base href="...">` в `index.html`.

## Требования

- Браузер с поддержкой WebAssembly (Chrome, Firefox, Safari, Edge).
- Для локального запуска — Python 3 или Node.js.
- Для сборки и тестов — [Flutter](https://docs.flutter.dev/get-started/install) в PATH.
- **Размытие лиц** использует браузерный Face Detector API (Shape Detection); поддержка есть в Chrome и других Chromium-браузерах. В Firefox/Safari лица не обнаруживаются — фото остаётся без изменений.
